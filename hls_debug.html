<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>LL-HLS Debug Player</title>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    body { margin: 0; background: #000; color: #0f0; font-family: monospace; display: flex; }
    #video { width: 70vw; height: 100vh; background: #000; }
    #log { width: 30vw; height: 100vh; overflow-y: auto; padding: 8px; box-sizing: border-box; background: #111; }
    .error { color: #f55; }
  </style>
</head>
<body>
  <video id="video" controls autoplay playsinline></video>
  <div id="log"></div>

  <script>
    const src = "http://172.235.33.35:3333/app/test/llhls.m3u8";
    const video = document.getElementById("video");
    const logDiv = document.getElementById("log");

    function log(msg, isError = false) {
      const line = document.createElement("div");
      if (isError) line.classList.add("error");
      line.textContent = `[${new Date().toISOString()}] ${msg}`;
      logDiv.appendChild(line);
      logDiv.scrollTop = logDiv.scrollHeight;
      console[isError ? "error" : "log"](msg);
    }

    function start() {
      log("Starting HLS debug player...");
      if (video.canPlayType("application/vnd.apple.mpegurl")) {
        log("Native HLS supported, using video.src");
        video.src = src;
        video.play().catch(e => log("Play error (native): " + e, true));
      } else if (Hls.isSupported()) {
        log("Hls.js is supported, initializing...");
        const hls = new Hls({ lowLatencyMode: true });
        hls.on(Hls.Events.MEDIA_ATTACHED, () => log("MEDIA_ATTACHED"));
        hls.on(Hls.Events.MANIFEST_LOADING, () => log("MANIFEST_LOADING"));
        hls.on(Hls.Events.MANIFEST_LOADED, (e, data) => log("MANIFEST_LOADED: " + data.levels.length + " level(s)"));
        hls.on(Hls.Events.LEVEL_LOADED, (e, data) => log(`LEVEL_LOADED: SN ${data.details.startSN}..${data.details.endSN}`));
        hls.on(Hls.Events.FRAG_LOADED, (e, data) => log(`FRAG_LOADED: ${data.frag.sn}`));
        hls.on(Hls.Events.ERROR, (e, data) => log("HLS ERROR: " + JSON.stringify(data), true));

        hls.loadSource(src);
        hls.attachMedia(video);
      } else {
        log("HLS not supported in this browser", true);
        alert("HLS not supported in this browser");
      }
    }

    video.addEventListener("click", () => {
      if (video.paused) {
        video.play().catch(e => log("Play error (click): " + e, true));
      }
    });

    start();
  </script>
</body>
</html>
